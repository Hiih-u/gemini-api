# Gemini Chat (Kasm Multi-Account Edition)

è¿™æ˜¯ä¸€ä¸ªåŸºäº **FastAPI** å’Œ **Kasm Workspaces** æ„å»ºçš„ Gemini AI æ™ºèƒ½å¯¹è¯ç³»ç»Ÿã€‚

æœ¬é¡¹ç›®åˆ©ç”¨ Kasm çš„å®¹å™¨åŒ–æ¡Œé¢ç¯å¢ƒï¼Œå®Œç¾è§£å†³äº† Gemini Web API çš„ Cookie è·å–ä¸ä¿æ´»é—®é¢˜ã€‚é€šè¿‡åœ¨å®¹å™¨å†…éƒ¨è¿è¡Œ Chrome æµè§ˆå™¨ï¼Œç³»ç»Ÿèƒ½å¤Ÿ**å…¨è‡ªåŠ¨è·å–å’Œåˆ·æ–° Google è´¦å· Cookie**ã€‚

**ç‰¹åˆ«å¢å¼º**ï¼šæœ¬é¡¹ç›®å·²å‡çº§ä¸º**å¤šå®ä¾‹æ¶æ„**ï¼Œæ”¯æŒåŒæ—¶è¿è¡Œå¤šä¸ªç‹¬ç«‹çš„ Workerï¼Œæ¯ä¸ª Worker ç»‘å®šç‹¬ç«‹çš„ Google è´¦å·å’Œæµè§ˆå™¨ç¯å¢ƒï¼Œå®ç°ç‰©ç†çº§çš„æ•°æ®éš”ç¦»ä¸è´Ÿè½½åˆ†æ‹…ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

* **ğŸ›¡ï¸ é›¶é…ç½®è‡ªåŠ¨é‰´æƒ**: é›†æˆå®Œæ•´ Ubuntu æ¡Œé¢ç¯å¢ƒï¼Œåœ¨å®¹å™¨å†…ç™»å½•ä¸€æ¬¡ Google è´¦å·ï¼Œå³å¯è‡ªåŠ¨æŠ“å–å¹¶ç»´æŠ¤ `__Secure-1PSID`ã€‚
* **ğŸ‘¥ å¤šè´¦æˆ·æ”¯æŒ (New)**: é€šè¿‡ `docker-compose` è½»æ¾æ‰©å±•å¤šä¸ª Workerï¼Œæ¯ä¸ª Worker æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®ç›®å½• (`profiles/`, `data/`)ï¼Œäº’ä¸å¹²æ‰°ï¼Œæœ‰æ•ˆè§„é¿å•è´¦å·é€Ÿç‡é™åˆ¶ã€‚
* **âš¡ è‡ªåŠ¨åŒ–éƒ¨ç½² (New)**: æä¾› `init.sh` è„šæœ¬ï¼Œè‡ªåŠ¨è¯†åˆ« Worker æ•°é‡å¹¶åˆå§‹åŒ–æ‰€éœ€çš„æ–‡ä»¶ç»“æ„ä¸æƒé™ï¼Œå‘Šåˆ«ç¹ççš„æ‰‹åŠ¨é…ç½®ã€‚
* **ğŸ’¾ æ™ºèƒ½ Cookie ç¼“å­˜**: ç³»ç»Ÿä¼šå°†å‡­è¯ç¼“å­˜è‡³æœ¬åœ° (`cookie_cache.json`)ï¼Œé‡å¯åä¼˜å…ˆè¯»å–ç¼“å­˜ï¼Œå‡å°‘å¯¹æµè§ˆå™¨çš„ä¾èµ–ã€‚
* **ğŸ”Œ ç†”æ–­ä¿æŠ¤æœºåˆ¶**: å†…ç½®æ™ºèƒ½ç†”æ–­é€»è¾‘ï¼Œè¿ç»­è®¤è¯å¤±è´¥ 3 æ¬¡è‡ªåŠ¨å†·å´ 300 ç§’ã€‚
* **ğŸš€ å…¼å®¹ OpenAI æ¥å£**: æä¾›å…¼å®¹ OpenAI æ ¼å¼çš„ `/v1/chat/completions` æ¥å£ã€‚

---

## ğŸ› ï¸ éƒ¨ç½²æŒ‡å—

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿å·²å®‰è£… [Docker](https://docs.docker.com/get-docker/) å’Œ [Docker Compose](https://docs.docker.com/compose/install/)ã€‚

### 2. è·å–ä»£ç 

```bash
git clone https://github.com/Hiih-u/gemini-api.git
cd gemini-chat

```

### 3. é…ç½® Worker æ•°é‡ (å¯é€‰)

é»˜è®¤çš„ `compose.yml` å·²ç»é…ç½®äº† **2 ä¸ª Worker** (`worker-1` å’Œ `worker-2`)ã€‚
å¦‚æœæ‚¨éœ€è¦æ›´å¤šè´¦æˆ·ï¼Œè¯·ç›´æ¥å¤åˆ¶ `compose.yml` ä¸­çš„æœåŠ¡å®šä¹‰ï¼Œå¹¶ä¿®æ”¹å¯¹åº”çš„ç«¯å£å·ã€‚

### 4. âš¡ ä¸€é”®åˆå§‹åŒ– (æ ¸å¿ƒæ­¥éª¤)

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬æ¥è§£å†³ Docker æŒ‚è½½æ–‡ä»¶æ—¶çš„æƒé™é—®é¢˜å’Œç›®å½•ç»“æ„åˆ›å»ºã€‚

**è¯·åŠ¡å¿…è¿è¡Œæ­¤è„šæœ¬ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨åˆ›å»ºç›®å½•ï¼**

```bash
# 1. èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™
chmod +x init.sh

# 2. è¿è¡Œåˆå§‹åŒ–è„šæœ¬
./init.sh

```

### 5. å¯åŠ¨å®¹å™¨

```bash
docker compose up -d

```

---

## ğŸ‘¥ å¤šè´¦æˆ·é…ç½®ä¸å¯åŠ¨ (æ ¸å¿ƒæµç¨‹)

å¯åŠ¨å®¹å™¨åï¼Œæ‚¨éœ€è¦åˆ†åˆ«è¿›å…¥æ¯ä¸ª Worker çš„æ¡Œé¢ç¯å¢ƒç™»å½•è´¦å·ï¼Œå¹¶æ‰‹åŠ¨å¯åŠ¨ API æœåŠ¡ã€‚

### Worker 1 é…ç½® (è´¦å· A)

**1. ç™»å½• Google è´¦å·**

* **è¿›å…¥æ¡Œé¢**: æµè§ˆå™¨è®¿é—® `https://localhost:6901` (ç”¨æˆ·: `kasm_user` / å¯†ç : `password`)
* **ç™»å½•**: åœ¨ Kasm æ¡Œé¢å†…æ‰“å¼€ Chromeï¼Œç™»å½• **Google è´¦å· A**ã€‚

**2. å¯åŠ¨ API æœåŠ¡**
æ‚¨å¯ä»¥åœ¨ Kasm æ¡Œé¢çš„ç»ˆç«¯ä¸­è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨å®¿ä¸»æœºé€šè¿‡ Docker å‘½ä»¤å¯åŠ¨ï¼š

```bash
# è¿›å…¥ Worker 1 å®¹å™¨
docker exec -it gemini-kasm-1 bash

# --- å®¹å™¨å†…æ‰§è¡Œ ---
# 1. åŠ è½½ D-Bus ç¯å¢ƒ (è§£é” Cookie è¯»å–æƒé™)
eval $(dbus-launch --sh-syntax)

# 2. å¯åŠ¨åç«¯æœåŠ¡
python3.10 server.py > /proc/1/fd/1 2>&1

```

*çœ‹åˆ° `ğŸš€ å¯åŠ¨ Gemini Chat æœåŠ¡å™¨` æ—¥å¿—å³è¡¨ç¤º Worker 1 (ç«¯å£ 8001) å°±ç»ªã€‚*

---

## ğŸ”Œ API è°ƒç”¨

æ‚¨ç°åœ¨æ‹¥æœ‰å¤šä¸ªç‹¬ç«‹çš„ API ç«¯ç‚¹ï¼š

* **Worker 1**: `http://localhost:8001` (å¯¹åº”è´¦å· A)
* **Worker 2**: `http://localhost:8002` (å¯¹åº”è´¦å· B)

**OpenAI å…¼å®¹æ¥å£ç¤ºä¾‹:**

```bash
curl http://localhost:8001/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gemini-3.0-pro",
    "messages": [{"role": "user", "content": "ä½ å¥½"}]
  }'

```

---

## ğŸ“‚ ç›®å½•ç»“æ„

åœ¨ä½¿ç”¨ `init.sh` åˆå§‹åŒ–åï¼Œæ‚¨çš„ç›®å½•ç»“æ„å°†å¦‚ä¸‹æ‰€ç¤ºï¼š

```text
.
â”œâ”€â”€ init.sh                 # âš¡ è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ compose.yml             # å¤š Worker ç¼–æ’é…ç½®
â”œâ”€â”€ profiles/               # Chrome é…ç½®æ–‡ä»¶ (è‡ªåŠ¨ç”Ÿæˆ)
â”‚   â”œâ”€â”€ worker1/            # Worker 1 çš„æµè§ˆå™¨æ•°æ®
â”‚   â””â”€â”€ worker2/            # Worker 2 çš„æµè§ˆå™¨æ•°æ®
â”œâ”€â”€ data/                   # è¿è¡Œæ—¶æ•°æ® (è‡ªåŠ¨ç”Ÿæˆ)
â”‚   â”œâ”€â”€ worker1/
â”‚   â”‚   â”œâ”€â”€ conversations/  # è´¦å· A çš„å¯¹è¯å†å²
â”‚   â”‚   â”œâ”€â”€ images/         # è´¦å· A ç”Ÿæˆçš„å›¾ç‰‡
â”‚   â”‚   â””â”€â”€ cookie_cache.json # è´¦å· A çš„ Cookie
â”‚   â””â”€â”€ worker2/
â”‚       â”œâ”€â”€ ...             # è´¦å· B çš„æ•°æ® (å®Œå…¨éš”ç¦»)
â””â”€â”€ server.py               # æ ¸å¿ƒä»£ç 

```

---

## â“ å¸¸è§é—®é¢˜ (FAQ)

**Q: ä¸ºä»€ä¹ˆå¿…é¡»æ‰‹åŠ¨æ‰§è¡Œ `python3.10 server.py`ï¼Ÿ**
A: å› ä¸º Kasm é•œåƒé»˜è®¤å¯åŠ¨çš„æ˜¯æ¡Œé¢ç¯å¢ƒ (VNC)ã€‚æˆ‘ä»¬éœ€è¦æ¡Œé¢ç¯å¢ƒæ¥è¿è¡Œ Chrome æµè§ˆå™¨ä¿æŒç™»å½•çŠ¶æ€ï¼Œæ‰€ä»¥ Python API æœåŠ¡éœ€è¦ä½œä¸ºä¸€ä¸ªåå°è¿›ç¨‹æ‰‹åŠ¨å¯åŠ¨ã€‚

**Q: æŠ¥é”™ `ImportError: cannot import name 'StrEnum'`?**
A: è¯·ç¡®ä¿ä½¿ç”¨çš„æ˜¯ `python3.10 server.py`ã€‚Kasm é•œåƒè‡ªå¸¦å¤šä¸ª Python ç‰ˆæœ¬ï¼Œç›´æ¥ç”¨ `python3` å¯èƒ½ä¼šè°ƒç”¨æ—§ç‰ˆæœ¬ã€‚

**Q: å¦‚ä½•å¢åŠ  Worker 3?**
A:

1. ä¿®æ”¹ `compose.yml`ï¼Œå¤åˆ¶ `worker-2` çš„é…ç½®ï¼Œæ”¹ä¸º `worker-3` (å®¹å™¨å `gemini-kasm-3`)ï¼Œç«¯å£æ”¹ä¸º `6903/8003`ã€‚
2. è¿è¡Œ `./init.sh` è‡ªåŠ¨åˆ›å»ºç›®å½•ã€‚
3. è¿è¡Œ `docker compose up -d`ã€‚
4. å‚ç…§ä¸Šè¿°æ­¥éª¤ç™»å½•è´¦å·å¹¶å¯åŠ¨æœåŠ¡ã€‚